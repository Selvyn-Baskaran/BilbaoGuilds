<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title><%= event.title %> - Event</title>
  <link rel="stylesheet" href="/styles.css"/>
  <link rel="stylesheet" href="/css/navbar.css">
  <style>
    :root {
      --hero-grad: linear-gradient(135deg, #7b4dff 0%, #9b62fc 50%, #b98eff 100%);
      --card-bg: rgba(255,255,255,.88);
      --card-border: rgba(0,0,0,.08);
      --ink: #0f0f14;
      --muted: #6b6b6b;
      --chip-bg: rgba(123,77,255,.12);
      --chip-br: rgba(123,77,255,.35);
      --accent: #6e38ff;
    }
    body.dark-mode {
      --card-bg: rgba(28,28,32,.92);
      --card-border: rgba(255,255,255,.08);
      --ink: #f1f1f1;
      --muted: #bdbdbd;
      --chip-bg: rgba(110,56,255,.2);
      --chip-br: rgba(110,56,255,.45);
    }

    .event-wrap {
      max-width: 1100px;
      width: min(1100px, 100% - 24px);
      margin: 12px auto 28px;
    }

    /* Hero */
    .event-hero {
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      min-height: 180px;
      background: var(--hero-grad);
      box-shadow: 0 12px 30px rgba(0,0,0,.12);
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: end;
    }
    .event-hero::after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(1200px 280px at 20% -10%, rgba(255,255,255,.35), transparent 55%);
      pointer-events:none;
    }
    .hero-content {
      padding: 22px 22px 18px;
      color: #fff;
      z-index:1;
    }
    .eyebrow {
      font-size: .8rem;
      letter-spacing: .08em;
      text-transform: uppercase;
      opacity: .9;
      margin-bottom: 6px;
    }
    .hero-title {
      margin: 0;
      font-size: clamp(1.3rem, 2.6vw + .2rem, 2rem);
      font-weight: 800;
      line-height: 1.1;
      text-shadow: 0 2px 18px rgba(0,0,0,.25);
    }

    /* Back button */
    .hero-actions {
      z-index:1;
      padding: 0 16px 16px 0;
      align-self: start;
      justify-self: end;
    }
    .btn-ghost {
      display:inline-flex; align-items:center; gap:.5rem;
      padding: .55rem .8rem;
      border-radius: 12px;
      background: rgba(255,255,255,.16);
      color:#fff; text-decoration:none;
      border:1px solid rgba(255,255,255,.3);
      backdrop-filter: blur(6px);
      transition: transform .08s ease, opacity .15s ease;
    }
    .btn-ghost:hover { transform: translateY(-1px); opacity:.95; }

    /* Content grid */
    .event-grid {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 14px;
      margin-top: 12px;
    }
    @media (max-width: 960px){
      .event-grid{ grid-template-columns: 1fr; }
    }

    /* Main card */
    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 25px rgba(0,0,0,.08), 0 1px 0 rgba(255,255,255,.6) inset;
      color: var(--ink);
    }
    .card h3 { margin: 0 0 8px; }

    /* Details chips */
    .chips { display:flex; flex-wrap:wrap; gap: 8px; margin: 10px 0 14px; }
    .chip {
      display:inline-flex; align-items:center; gap:.4rem;
      padding: .4rem .6rem;
      border-radius: 999px;
      font-size: .85rem;
      background: var(--chip-bg);
      border: 1px solid var(--chip-br);
      color: var(--ink);
      white-space: nowrap;
    }
    .chip b { font-weight: 700; }

    .desc {
      line-height: 1.55;
      color: var(--ink);
    }
    .desc.muted { color: var(--muted); }

    /* Side info */
    .side { position: sticky; top: 12px; height: fit-content; }
    .info-row { display:flex; gap:.6rem; align-items:flex-start; }
    .info-row + .info-row { margin-top: .6rem; }
    .info-label { width: 90px; font-weight: 700; color: var(--ink); }
    .info-val { color: var(--ink); }

    /* CTA buttons */
    .actions {
      display:flex; gap:10px; flex-wrap:wrap; margin-top: 14px;
    }
    .btn {
      display:inline-flex; align-items:center; gap:.5rem;
      padding:.6rem .9rem; border-radius:12px; text-decoration:none;
      border:1px solid #6e38ff33;
      background: #6e38ff; color:#fff;
      box-shadow: 0 6px 16px rgba(110,56,255,.35);
      transition: transform .08s ease, filter .15s ease;
    }
    .btn:hover { transform: translateY(-1px); filter: brightness(1.03); }
    .btn.secondary {
      background: transparent; color: var(--accent);
      border: 1px solid var(--accent);
      box-shadow: none;
    }

    /* Poster styles */
    .poster {
      margin: 0 0 12px;
      position: relative;
      overflow: hidden;
      border-radius: 14px;
      aspect-ratio: 16/9;
      background: rgba(0,0,0,.06);
    }
    .poster img {
      width: 100%; height: 100%;
      object-fit: cover; display: block;
    }
    .poster-actions {
      position: absolute; right: 10px; top: 10px;
    }

    /* Uploader (admin-only when no poster yet) */
    .poster-upload .poster-drop {
      display:block; border:1px dashed rgba(0,0,0,.2);
      border-radius:14px; padding: 18px; cursor: pointer;
      background: rgba(0,0,0,.02);
    }
    .poster-upload .poster-drop:hover { background: rgba(0,0,0,.04); }
    .poster-drop-ui {
      display:flex; gap:10px; align-items:center; justify-content:center; text-align:center;
      color: var(--ink);
    }
    .poster-drop-ui .icon { font-size: 1.4rem; }

        /* ===== POSTER LIGHTBOX VIEW ===== */
    .poster img { cursor: zoom-in; transition: transform .25s ease; }

    /* Overlay backdrop */
    #lightbox {
      position: fixed; inset: 0;
      background: rgba(0,0,0,.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    #lightbox.active { display: flex; animation: fadeIn .2s ease; }

    #lightbox img {
      max-width: 92vw;
      max-height: 92vh;
      border-radius: 10px;
      box-shadow: 0 0 40px rgba(0,0,0,.6);
      cursor: zoom-out;
    }

    @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }


    /* Mini section titles */
    .subtle { font-size:.9rem; opacity:.8; margin: 0 0 6px; }

    /* Divider */
    .hr { height:1px; background: var(--card-border); margin: 12px 0; }
  </style>
</head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script>
  // Default to dark when nothing saved yet
  const dm = localStorage.getItem('darkMode');
  if (dm === 'enabled' || dm === null) {
    document.documentElement.classList.add('dark-mode');
    if (dm === null) localStorage.setItem('darkMode','enabled');
  }
</script>
<!-- Lightbox overlay -->
<div id="lightbox"><img src="" alt="Poster"></div>

<body class="<%= guild %>">

  <%- include('partials/navbar', { user, guild, points, online }) %>

  <main class="event-wrap">
    <!-- HERO -->
    <section class="event-hero">
      <div class="hero-content">
        <div class="eyebrow">Guilds ‚Ä¢ Event</div>
        <h1 class="hero-title"><%= event.title %></h1>
      </div>
      <div class="hero-actions">
        <a class="btn-ghost" href="/events">‚¨Ö Back to Events</a>
      </div>
    </section>

    <!-- CONTENT -->
    <section class="event-grid">
      <!-- Main -->
      <article class="card">
        <% const isAdmin = (role === 'admin' || role === 'manager'); %>

        <!-- POSTER (if present) -->
        <% if (event.poster) { %>
          <figure class="poster">
            <img src="<%= event.poster %>" alt="Event poster">
            <% if (isAdmin) { %>
              <form class="poster-actions" method="POST" action="/admin/events/<%= event.id %>/poster/delete">
                <button class="btn secondary" type="submit">Remove poster</button>
              </form>
            <% } %>
          </figure>
        <% } else if (isAdmin) { %>
          <!-- Inline uploader visible only to admins if no poster yet -->
          <form class="poster-upload" method="POST" action="/admin/events/<%= event.id %>/poster" enctype="multipart/form-data">
            <label class="poster-drop">
              <input id="posterInput" type="file" name="poster" accept="image/png,image/jpeg,image/gif,image/webp" hidden>
              <div class="poster-drop-ui">
                <div class="icon">üñºÔ∏è</div>
                <div><strong>Upload a poster</strong><br><span>PNG/JPG/GIF/WEBP ¬∑ up to 5MB</span></div>
              </div>
            </label>
            <div class="actions" style="margin-top:10px;">
              <button class="btn" type="submit">Save poster</button>
              <a class="btn secondary" href="/events/<%= event.id %>">Cancel</a>
            </div>
          </form>
        <% } %>

        <h3>About this event</h3>

        <!-- Quick chips -->
        <div class="chips">
          <span class="chip">üìÖ <b><%= event.date %></b></span>
          <span class="chip">‚è∞ <b><%= event.time || 'All day' %></b></span>
          <% if (event.location) { %>
            <span class="chip">üìç <b><%= event.location %></b></span>
          <% } %>
        </div>

        <!-- Description -->
        <% if (event.description && event.description.trim().length) { %>
          <p class="desc"><%= event.description %></p>
        <% } else { %>
          <p class="desc muted">No description provided.</p>
        <% } %>

        <div class="actions">
          <a class="btn" href="/events">Back to Calendar</a>
          <a class="btn secondary" href="#" id="copyLink">Copy Link</a>
        </div>
      </article>

      <!-- Sidebar -->
      <aside class="side card">
        <h4 class="subtle">Event details</h4>

        <div class="info-row">
          <div class="info-label">Title</div>
          <div class="info-val"><%= event.title %></div>
        </div>
        <div class="info-row">
          <div class="info-label">Date</div>
          <div class="info-val"><%= event.date %></div>
        </div>
        <div class="info-row">
          <div class="info-label">Time</div>
          <div class="info-val"><%= event.time || 'All day' %></div>
        </div>
        <% if (event.location) { %>
        <div class="info-row">
          <div class="info-label">Location</div>
          <div class="info-val"><%= event.location %></div>
        </div>
        <% } %>

        <div class="hr"></div>

        <div class="info-row">
          <div class="info-label">Guild</div>
          <div class="info-val"><%= guild %></div>
        </div>

        <div class="actions" style="margin-top:12px;">
          <a class="btn secondary" href="/events">‚Üê Back</a>
        </div>
      </aside>
    </section>
  </main>

  <script>
    // Copy event link quickly
    (function(){
      const btn = document.getElementById('copyLink');
      if(!btn) return;
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => {
          btn.textContent = 'Link copied!';
          setTimeout(()=> btn.textContent='Copy Link', 1200);
        });
      });
    })();

    // Poster uploader UX: click anywhere on the drop area to open file dialog
    (function(){
      const input = document.getElementById('posterInput');
      if(!input) return;
      const drop = input.closest('.poster-drop');
      if (drop) drop.addEventListener('click', () => input.click());
    })();

    
  </script>

  <script>
  // Poster fullscreen preview
  (function(){
    const poster = document.querySelector('.poster img');
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = lightbox?.querySelector('img');

    if (poster && lightbox && lightboxImg) {
      poster.addEventListener('click', () => {
        lightboxImg.src = poster.src;
        lightbox.classList.add('active');
      });
      lightbox.addEventListener('click', () => {
        lightbox.classList.remove('active');
        setTimeout(()=> lightboxImg.src = '', 200);
      });
    }
  })();
</script>


</body>
</html>
