/* =================== Base & Variables =================== */
* { box-sizing: border-box; }
html { -webkit-text-size-adjust: 100%; }

:root{
  --nav-h: 56px;
  --ink:#0f0f14;
  --muted:#6b6b6b;
  --panel:rgba(255,255,255,.9);
  --panel-br:rgba(0,0,0,.08);
  --accent:#6e38ff;
  --pill:#f7f3ff;
}

html.dark-mode{
  --ink:#f1f1f1;
  --muted:#bdbdbd;
  --panel:rgba(15,15,20,.9);
  --panel-br:rgba(255,255,255,.08);
  --accent:#8d6bff;
  --pill:#221a3b;
}

body{
  margin: 0;
  font-family: sans-serif;
  color: var(--ink);
  background: var(--panel);
}

/* Helpers */
.truncate { max-width: 60vw; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
img, video { max-width: 100%; height: auto; }
table { width: 100%; border-collapse: collapse; display: block; overflow-x: auto; }
h1,h2,h3{ line-height:1.2; word-wrap:break-word; }
p,li{ line-height:1.5; word-wrap:break-word; }

/* =================== Navbar (single source) =================== */
.navbar{
  position: sticky; top: 0; z-index: 1000;
  display: block;
  background: linear-gradient(90deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  backdrop-filter: blur(8px);
  border-bottom: 1px solid var(--panel-br);
}

/* Header row: left (logo/stats), center (title), right (burger) */
.navbar-header{
  display: grid;
  grid-template-columns: 1fr auto auto;
  align-items: center;
  gap: .75rem;
  padding: .6rem 1rem;
  min-height: var(--nav-h);
}

.navbar-logo{ display:flex; align-items:center; gap:.5rem; min-width:0; }
.navbar-logo .truncate{ max-width: 50vw; }

/* Center title */
.navbar-center-title{
  font-weight:800; letter-spacing:.03em; text-decoration:none;
  padding:.2rem .6rem; border-radius:10px; white-space:nowrap;
  color:#fff;
  transition: color .15s ease, text-shadow .2s ease, background .15s ease;
}
.navbar-center-title:hover{
  color:#dcd2ff; text-shadow:0 0 10px rgba(110,56,255,.7); background: rgba(110,56,255,.12);
}

/* Right-side burger */
.navbar-toggle{
  font-size:1.6rem; line-height:1;
  background:none; border:0; color:var(--ink); cursor:pointer;
  margin-left:.5rem;
}

/* Link row (collapsible) */
.navbar-links{
  display:flex; gap:1rem; list-style:none; margin:0; padding:.4rem 1rem 1rem;
  border-top:1px solid var(--panel-br);
}
.navbar-links a{ color: var(--ink); text-decoration:none; font-weight:500; }
.navbar-links a:hover{ opacity:.85; text-shadow: 0 0 6px rgba(255,255,255,.35); }

/* Guild gradients */
body.Fire  .navbar{ background: linear-gradient(90deg, #a33 0%, #180303 100%); box-shadow: 0 4px 18px rgba(255,60,60,.25); }
body.Water .navbar{ background: linear-gradient(90deg, #2e4ca8 0%, #081237 100%); box-shadow: 0 4px 18px rgba(80,130,255,.25); }
body.Earth .navbar{ background: linear-gradient(90deg, #2e7a38 0%, #032908 100%); box-shadow: 0 4px 18px rgba(60,200,80,.25); }

/* Avatar */
.nav-avatar{ width:32px; height:32px; border-radius:50%; object-fit:cover; }
body.Fire  .avatar--default { filter: hue-rotate(140deg) saturate(1.6) brightness(1.1); }
body.Water .avatar--default { filter: hue-rotate(10deg)  saturate(1.8) brightness(1.1); }
body.Earth .avatar--default { filter: hue-rotate(240deg) saturate(1.5) brightness(1.1); }
body.Fire  .nav-avatar { box-shadow: 0 0 0 2px rgba(255, 0, 64, 0.65); }
body.Water .nav-avatar { box-shadow: 0 0 0 2px rgba(42,167,255,.65); }
body.Earth .nav-avatar { box-shadow: 0 0 0 2px rgba(0, 191, 255, 0.65); }

/* Mobile tweaks: hide center title to avoid overlap; collapse links */
@media (max-width: 900px){
  .navbar-center-title { display: none !important; }
  .truncate { max-width: 28ch; }
}
@media (max-width: 768px){
  .navbar-header { grid-template-columns: 1fr auto; }
  .navbar-links     { display:none; flex-direction:column; }
  .navbar-links.show{ display:flex; }
}

/* =================== Layout / Main =================== */
main { padding: 1rem; }

form {
  max-width: 300px; margin: 2rem auto;
  display: flex; flex-direction: column; gap: 0.5rem;
}

input, button { padding: 0.5rem; font-size: 1rem; }

/* Tables */
th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
th { background: rgba(255,255,255,.1); } /* works in dark & light */

/* =================== Leaderboard Cards =================== */
.lb-wrap { max-width: 1100px; margin: 2rem auto; padding: 0 1rem; }
.pillars { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.25rem; align-items: end; }
@media (max-width: 800px){ .pillars{ grid-template-columns: 1fr; } }

.pillar-card {
  position: relative; padding: 1rem; border-radius: 14px;
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 8px 24px rgba(0,0,0,0.25);
  overflow: hidden;
}
.pillar { position: relative; height: 280px; display:flex; align-items:flex-end; justify-content:center; }
.pillar .base {
  position:absolute; bottom:6px; width:72%; height:14px;
  background: linear-gradient(#2f2f2f,#202020);
  border-radius: 4px; box-shadow: inset 0 2px 0 rgba(255,255,255,0.12);
}
.pillar .capital {
  position:absolute; bottom: calc(var(--h, 0%) + 18px);
  width:66%; height:14px;
  background: linear-gradient(#3a3a3a,#1d1d1d);
  border-radius: 4px;
  transition: transform .9s ease, bottom .9s ease;
}
.pillar .shaft {
  --target-h: 10%;
  position:absolute; bottom: 32px; width: 60%;
  height: 0%;
  background: linear-gradient(180deg, #5c5c5c 0%, #2c2c2c 100%);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px 8px 4px 4px;
  box-shadow: inset 0 10px 18px rgba(255,255,255,0.06), inset 0 -12px 18px rgba(0,0,0,0.35);
  transition: height 1.2s cubic-bezier(.2,.9,.2,1);
}
.pillar .shaft.rise { height: var(--target-h); }

@keyframes shake {
  0%,100%{ transform: translateX(0); }
  20%{ transform: translateX(-2px); }
  40%{ transform: translateX(2px); }
  60%{ transform: translateX(-2px); }
  80%{ transform: translateX(2px); }
}
.pillar-card.crumble .shaft { animation: shake .6s ease; }

.badge { position: absolute; top: 12px; right: 12px; }
.badge img { width: 64px; height: 64px; object-fit: contain; filter: drop-shadow(0 6px 10px rgba(0,0,0,0.45)); }

.stats { text-align:center; margin-top:.5rem; }
.guild-name { font-weight: 600; letter-spacing:.5px; }
.points { font-size: 1.25rem; opacity:.9; }

/* Rank medals / crown for 1st */
.rank-medal {
  position:absolute; left: 12px; top: 10px; width: 38px; height: 38px;
  border-radius: 999px; display:flex; align-items:center; justify-content:center;
  font-weight: 700; background: #444; color:#fff;
  box-shadow: inset 0 2px 0 rgba(255,255,255,.15), 0 6px 14px rgba(0,0,0,.3);
}
.pillar-card.first  .rank-medal { background: linear-gradient(#f9d65c,#caa23a); color:#1b1200; }
.pillar-card.first {border: 1px solid rgba(255, 215, 0, 0.5);}
.pillar-card.second .rank-medal { background: linear-gradient(#dfe3e8,#aeb6bf); color:#1e2329; }
.pillar-card.third  .rank-medal { background: linear-gradient(#f0c59a,#b87b43); color:#2a1908; }

/* Guild themes */
.pillar-card.Fire  .shaft { background: linear-gradient(180deg,#a33,#3a1414); }
.pillar-card.Water .shaft { background: linear-gradient(180deg,#2e4ca8,#1a2342); }
.pillar-card.Earth .shaft { background: linear-gradient(180deg,#2e7a38,#17341b); }
.pillar-card.Fire  .guild-name { color: #ff6b6b; }
.pillar-card.Water .guild-name { color: #70a1ff; }
.pillar-card.Earth .guild-name { color: #7bd388; }

/* Gold glow */
@keyframes glowPulse{
  0%,100%{ box-shadow: 0 0 10px 3px rgba(255,215,0,.4), 0 0 20px 6px rgba(255,215,0,.2); }
  50%   { box-shadow: 0 0 25px 10px rgba(255,215,0,.8), 0 0 40px 15px rgba(255,215,0,.5); }
}
.pillar-card.first { animation: glowPulse 2.8s ease-in-out infinite; border-color: rgba(255, 215, 0, 0.4); }

/* =================== Chat / Messages =================== */
#messages{
  border: 1px solid rgba(0,0,0,.12) !important;
  padding: 10px !important;
  height: 420px !important;
  overflow-y: auto !important;
  background: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.65));
  border-radius: 14px;
  box-shadow: 0 10px 24px rgba(0,0,0,.08) inset;
}
html.dark-mode #messages{
  background: linear-gradient(180deg, rgba(30,30,30,.85), rgba(26,26,26,.85));
  border-color: rgba(255,255,255,.1) !important;
  box-shadow: 0 10px 24px rgba(0,0,0,.45) inset;
}

/* chat row (left) */
.chat-message{ display: grid; grid-template-columns: 34px 1fr; gap: 8px; align-items: start; margin: 8px 0; }
.chat-message.me{ grid-template-columns: 1fr 34px; }
.chat-avatar img{ width:32px;height:32px;border-radius:50%;object-fit:cover;background:#f2f2f2; }

.chat-text{
  background: #fff; border: 1px solid rgba(0,0,0,.08);
  border-radius: 14px; padding: 8px 10px; box-shadow: 0 6px 14px rgba(0,0,0,.06);
  line-height: 1.5; word-wrap: break-word;
}
html.dark-mode .chat-text{ background:#1f1f1f; border-color: rgba(255,255,255,.08); color:#f1f1f1; }

.chat-message.me .chat-text{
  background: #6e38ff; border-color: #6e38ff; color: #fff;
  box-shadow: 0 8px 18px rgba(110,56,255,.35);
}

.chat-meta{
  display:flex; gap:8px; align-items:center; margin-bottom: 4px;
  font-size:.85rem; opacity:.85;
}
.chat-meta .name{ font-weight: 700; opacity: 1; }
.chat-message.me .chat-meta .name{ opacity: .95; }
.chat-meta .time{ font-variant-numeric: tabular-nums; opacity:.8; }

/* Right-side ordering for "me" */
.chat-message.me .chat-avatar{ order: 2; }
.chat-message.me .chat-text{ order: 1; }

/* Inputs */
#msgInput{
  border:1px solid rgba(0,0,0,.12);
  border-radius: 12px; padding:.6rem .8rem;
}
html.dark-mode #msgInput{ background:#202020; border-color: rgba(255,255,255,.12); color:#fff; }
#sendBtn{
  border:1px solid #6e38ff33; background:#6e38ff; color:#fff;
  padding:.6rem .85rem; border-radius:12px; cursor:pointer;
  box-shadow: 0 6px 16px rgba(110,56,255,.35);
}
#sendBtn:hover{ filter: brightness(1.04); }

/* =================== Mobile-only helpers =================== */
.mobile-only { display: none; }
@media (max-width: 900px){ .mobile-only { display: list-item; } }
